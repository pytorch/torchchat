python3 torchchat.py export llama3.1 --quantize '{"linear:int4": {"groupsize": 256}, "precision": {"dtype":"bfloat16"}, "executor":{"accelerator":"cuda"}}' --output-aoti-package-path /tmp/model34.pt2
OMP_NUM_THREADS=16 numactl --cpunodebind=0 --membind=0 python3 torchchat.py generate llama3.1 --aoti-package-path /tmp/model34.pt2 --prompt "Once upon a time," --max-new-tokens 200 --device cuda --num-samples 3
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
python3 torchchat.py export llama3.1 --quantize '{"linear:int4": {"groupsize": 256}, "precision": {"dtype":"bfloat16"}, "executor":{"accelerator":"cuda"}}' --output-aoti-package-path /tmp/model34.pt2
Note: NumExpr detected 22 cores but "NUMEXPR_MAX_THREADS" not set, so enforcing safe limit of 16.
NumExpr defaulting to 16 threads.
PyTorch version 2.6.0.dev20241002+cu121 available.
W1113 19:22:48.037393 2739043 site-packages/torch/_export/__init__.py:225] +============================+
W1113 19:22:48.037883 2739043 site-packages/torch/_export/__init__.py:226] |     !!!   WARNING   !!!    |
W1113 19:22:48.038128 2739043 site-packages/torch/_export/__init__.py:227] +============================+
W1113 19:22:48.038322 2739043 site-packages/torch/_export/__init__.py:228] torch._export.aot_compile() is being deprecated, please switch to directly calling torch._inductor.aoti_compile_and_package(torch.export.export()) instead.
Using device=cuda
Setting max_seq_length to 300 for DSO export.
Loading model...
Time to load model: 5.67 seconds
Quantizing the model with: {'linear:int4': {'groupsize': 256}, 'precision': {'dtype': 'bfloat16'}, 'executor': {'accelerator': 'cuda'}}
Time to quantize model: 0.56 seconds
-----------------------------------------------------------
Exporting model using AOT Inductor to /tmp/model34.pt2
The generated packaged model can be found at: /tmp/model34.pt2
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
OMP_NUM_THREADS=16 numactl --cpunodebind=0 --membind=0 python3 torchchat.py generate llama3.1 --aoti-package-path /tmp/model34.pt2 --prompt "Once upon a time," --max-new-tokens 200 --device cuda --num-samples 3
PyTorch version 2.6.0.dev20241002+cu121 available.
lm_eval is not installed, GPTQ may not be usable
Warning: checkpoint path ignored because an exported DSO or PTE path was specified
Warning: checkpoint path ignored because an exported DSO or PTE path was specified
Using device=cuda NVIDIA PG509-210
Loading model...
Time to load model: 8.51 seconds
-----------------------------------------------------------
Once upon a time, in a far-off galaxy, there was a planet known as Zephyr. Zephyr was a peculiar planet, with a unique atmosphere that made its sky appear as if it was a vast canvas of shifting colors, constantly changing and reforming into new shapes.
The people of Zephyr lived in harmony with their ever-changing sky. They believed that the sky was a manifestation of their collective consciousness, reflecting their thoughts, emotions, and desires. Thus, the colors and patterns of the sky were considered to be a form of collective wisdom, guiding them in times of need.
A young girl named Lyra lived on Zephyr. Lyra was known throughout the planet for her exceptional abilities as a 'Sky-reader.' She claimed to have the power to decipher the language of the sky, understanding its hidden meanings and prophecies.
One day, a severe storm swept over Zephyr, shrouding the planet in a thick veil of grey mist. The sky turned a deep,
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                
Generated 199 tokens                 
Time for inference 1: 1.5241 sec total                 
Time to first token: 0.1769 sec with sequential prefill.                

      Total throughput: 131.2292 tokens/sec, 0.0076 s/token                 
First token throughput: 5.6530 tokens/sec, 0.1769 s/token                 
 Next token throughput: 147.7189 tokens/sec, 0.0068 s/token                     

Bandwidth achieved: 0.00 GB/s
*** This first iteration will include cold start effects for dynamic import, hardware caches. ***

========================================

Once upon a time, in a far-off land, there were three friends – Alex, Ben, and Chris. They were inseparable and loved to explore and have adventures together.
One day, as they were walking through a dense forest, they stumbled upon a mysterious map. It was yellowed with age, and the lines were thick and wavy. It seemed to have been hand-drawn by someone who loved the forest with all their heart.
As they unfolded the map, they saw that it was a treasure map. It indicated that there was a hidden treasure somewhere in the forest. The friends looked at each other with excitement and decided to embark on a treasure hunt.
However, there was a catch. The map seemed to be a bit...unreliable. It was a bit squiggly, and the writing was small and hard to read. Alex, who was a bit of a skeptic, thought that it was just a silly joke and that they would never find the treasure. But Ben, who was
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                
Generated 199 tokens                 
Time for inference 2: 1.3596 sec total                 
Time to first token: 0.0341 sec with sequential prefill.                

      Total throughput: 147.0978 tokens/sec, 0.0068 s/token                 
First token throughput: 29.3617 tokens/sec, 0.0341 s/token                 
 Next token throughput: 150.1228 tokens/sec, 0.0067 s/token                     

Bandwidth achieved: 0.00 GB/s

========================================

Once upon a time, in a world where magic was real and anything was possible, there lived a young girl named Lily who was known for her incredible talent in cooking. Her dishes were renowned for their unique flavors, which seemed to transport the eater to a different world. Among her favorite recipes was a traditional family recipe for her grandmother's famous “Midnight Sky Cake,” a heavenly treat that sparkled like the stars.
As the special occasion for the annual Harvest Festival approached, Lily’s mother, a skilled baker, entrusted her with the recipe to bake the iconic cake once again. This cake was passed down from generations and contained a secret ingredient that nobody knew about, except for Lily’s great-grandmother. This secret ingredient was said to be a type of edible glitter made from a special type of flower that only blooms during the night of the full moon.
With the Harvest Festival just around the corner, Lily was determined to master the recipe and impress the judges with her magnificent cake. She gathered all the necessary ingredients and baked
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                
Generated 199 tokens                 
Time for inference 3: 1.3622 sec total                 
Time to first token: 0.0340 sec with sequential prefill.                

      Total throughput: 146.8253 tokens/sec, 0.0068 s/token                 
First token throughput: 29.3723 tokens/sec, 0.0340 s/token                 
 Next token throughput: 149.8361 tokens/sec, 0.0067 s/token                     

Bandwidth achieved: 0.00 GB/s

========================================


      Average tokens/sec (total): 141.72                 
Average tokens/sec (first token): 21.46                 
Average tokens/sec (next tokens): 149.23 
                
Memory used: 0.06 GB

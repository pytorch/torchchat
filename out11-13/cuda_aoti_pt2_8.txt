python3 torchchat.py export llama3.1 --quantize '{"linear:int8": {"groupsize": 0}, "precision": {"dtype":"bfloat16"}, "executor":{"accelerator":"cuda"}}' --output-aoti-package-path /tmp/model8.pt2
OMP_NUM_THREADS=16 numactl --cpunodebind=0 --membind=0 python3 torchchat.py generate llama3.1 --aoti-package-path /tmp/model8.pt2 --prompt "Once upon a time," --max-new-tokens 200 --device cuda --num-samples 3
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
python3 torchchat.py export llama3.1 --quantize '{"linear:int8": {"groupsize": 0}, "precision": {"dtype":"bfloat16"}, "executor":{"accelerator":"cuda"}}' --output-aoti-package-path /tmp/model8.pt2
Note: NumExpr detected 22 cores but "NUMEXPR_MAX_THREADS" not set, so enforcing safe limit of 16.
NumExpr defaulting to 16 threads.
PyTorch version 2.6.0.dev20241002+cu121 available.
W1113 19:18:01.597104 2703772 site-packages/torch/_export/__init__.py:225] +============================+
W1113 19:18:01.597554 2703772 site-packages/torch/_export/__init__.py:226] |     !!!   WARNING   !!!    |
W1113 19:18:01.597757 2703772 site-packages/torch/_export/__init__.py:227] +============================+
W1113 19:18:01.598016 2703772 site-packages/torch/_export/__init__.py:228] torch._export.aot_compile() is being deprecated, please switch to directly calling torch._inductor.aoti_compile_and_package(torch.export.export()) instead.
Using device=cuda
Setting max_seq_length to 300 for DSO export.
Loading model...
Time to load model: 5.57 seconds
Quantizing the model with: {'linear:int8': {'groupsize': 0}, 'precision': {'dtype': 'bfloat16'}, 'executor': {'accelerator': 'cuda'}}
Time to quantize model: 0.42 seconds
-----------------------------------------------------------
Exporting model using AOT Inductor to /tmp/model8.pt2
The generated packaged model can be found at: /tmp/model8.pt2
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
OMP_NUM_THREADS=16 numactl --cpunodebind=0 --membind=0 python3 torchchat.py generate llama3.1 --aoti-package-path /tmp/model8.pt2 --prompt "Once upon a time," --max-new-tokens 200 --device cuda --num-samples 3
PyTorch version 2.6.0.dev20241002+cu121 available.
lm_eval is not installed, GPTQ may not be usable
Warning: checkpoint path ignored because an exported DSO or PTE path was specified
Warning: checkpoint path ignored because an exported DSO or PTE path was specified
Using device=cuda NVIDIA PG509-210
Loading model...
Time to load model: 6.59 seconds
-----------------------------------------------------------
Once upon a time, in the misty mountains of northern India, there lived a young girl named Rukmini. She was the daughter of a Brahmin priest and was known for her exceptional piety and devotion to the gods. Rukmini's friends and family often praised her for her unwavering faith and kindness towards others. Her dedication to the gods was so pure that the manifestations of the gods would often appear to her in her dreams and visions, guiding her on her spiritual path. One day, a wise and aged sadhu, a yogic wanderer, appeared at the Brahmin's house. He sensed the presence of a spiritual giant in Rukmini and saw an opportunity to awaken her to the higher truth. The sadhu began to teach Rukmini the mysteries of the universe, showing her the interconnectedness of all living beings and the impermanence of the material world. He also taught her the art of meditation, guiding her through the realms of the mind, and eventually to the
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                
Generated 199 tokens                 
Time for inference 1: 1.7948 sec total                 
Time to first token: 0.1809 sec with sequential prefill.                

      Total throughput: 111.4346 tokens/sec, 0.0090 s/token                 
First token throughput: 5.5280 tokens/sec, 0.1809 s/token                 
 Next token throughput: 123.3055 tokens/sec, 0.0081 s/token                     

Bandwidth achieved: 0.00 GB/s
*** This first iteration will include cold start effects for dynamic import, hardware caches. ***

========================================

Once upon a time, there was a beautiful woman named Claire who felt like her life was falling apart. She was struggling to make ends meet, her relationships were suffering, and she felt lost and alone.
One day, while wandering through a local park, Claire stumbled upon a small, quaint bookstore. The store was tucked away in a quiet corner of the park, and the sign above the door read "Moonlight Books." Claire felt an inexplicable pull to enter the store, and as she stepped inside, she was enveloped in a warm and cozy atmosphere.
The store was run by an elderly woman named Olivia, who greeted Claire with a warm smile. Olivia was a wise and kind soul, with a deep understanding of the human experience. She asked Claire about her troubles, and listened attentively as Claire poured out her heart.
Olivia nodded sympathetically as Claire spoke, her eyes twinkling with understanding. "You are not alone, my dear," she said. "We all face struggles and challenges in life
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                
Generated 199 tokens                 
Time for inference 2: 1.6419 sec total                 
Time to first token: 0.0396 sec with sequential prefill.                

      Total throughput: 121.8065 tokens/sec, 0.0082 s/token                 
First token throughput: 25.2415 tokens/sec, 0.0396 s/token                 
 Next token throughput: 124.1940 tokens/sec, 0.0081 s/token                     

Bandwidth achieved: 0.00 GB/s

========================================

Once upon a time, there was a young boy named Timmy who was struggling to find his place in the world. He felt lost and alone, and his parents were worried about him. They tried to offer him support and encouragement, but nothing seemed to be working.
One day, Timmy's teacher, Mrs. Johnson, noticed that he was struggling to connect with his classmates. She decided to take a different approach and asked Timmy to help her with a special project. She asked him to draw a picture of his idea of a perfect world.
Timmy was hesitant at first, but Mrs. Johnson's enthusiasm was infectious. He took his pencil and paper and began to draw. As he drew, he started to feel more confident and engaged. He began to imagine all the things he could do in his perfect world - build a castle, fly a plane, explore the ocean.
Mrs. Johnson was amazed at the depth and richness of Timmy's drawing. She saw that it was not just a picture,
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                
Generated 199 tokens                 
Time for inference 3: 1.6513 sec total                 
Time to first token: 0.0394 sec with sequential prefill.                

      Total throughput: 121.1168 tokens/sec, 0.0083 s/token                 
First token throughput: 25.3675 tokens/sec, 0.0394 s/token                 
 Next token throughput: 123.4585 tokens/sec, 0.0081 s/token                     

Bandwidth achieved: 0.00 GB/s

========================================


      Average tokens/sec (total): 118.12                 
Average tokens/sec (first token): 18.71                 
Average tokens/sec (next tokens): 123.65 
                
Memory used: 0.05 GB
